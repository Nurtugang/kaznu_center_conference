{% extends "conferences/base_conf.html" %}

{% block title %}Галерея | {{ conference.title }}{% endblock %}

{% block content %}
<section class="py-16" x-data="{ 
    open: false, 
    currentIndex: 0, 
    images: [
        {% for item in media %}{% if not item.is_video %}'{{ item.file.url }}'{% endif %}{% if not forloop.last and not item.is_video %},{% endif %}{% endfor %}
    ],
    next() { this.currentIndex = (this.currentIndex + 1) % this.images.length },
    prev() { this.currentIndex = (this.currentIndex - 1 + this.images.length) % this.images.length }
}">
    <div class="container mx-auto px-6">
        <h1 class="text-3xl font-black text-dark uppercase mb-12 flex items-center gap-3">
            <span class="w-12 h-1 bg-brand rounded-full"></span>Медиаматериалы
        </h1>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
            {% for item in media %}
            <div class="group relative aspect-video bg-gray-900 rounded-[2rem] overflow-hidden shadow-lg border border-gray-100 cursor-pointer">
                
                {% if item.is_video %}
                    <video class="w-full h-full object-cover" controls preload="metadata">
                        <source src="{{ item.file.url }}" type="video/mp4">
                    </video>
                    <div class="absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
                        <span class="bg-brand text-white text-[9px] font-black px-3 py-1.5 rounded-full uppercase tracking-widest shadow-lg">Video</span>
                    </div>
                {% else %}
                    <img src="{{ item.file.url }}" 
                         @click="open = true; currentIndex = images.indexOf('{{ item.file.url }}')"
                         class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700" 
                         alt="{{ item.caption }}">
                    
                    <div class="absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
                        <span class="bg-white/20 backdrop-blur-md text-white text-[9px] font-black px-3 py-1.5 rounded-full uppercase tracking-widest border border-white/30 shadow-lg">Photo</span>
                    </div>
                {% endif %}

                {% if item.caption %}
                <div class="absolute inset-0 bg-gradient-to-t from-dark/80 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-all duration-500 flex items-end p-8 pointer-events-none">
                    <p class="text-white text-xs font-bold uppercase tracking-widest translate-y-4 group-hover:translate-y-0 transition-transform duration-500">
                        {{ item.caption }}
                    </p>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>

    <template x-teleport="body">
    <div x-show="open" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-[100] flex items-center justify-center bg-black/95 backdrop-blur-sm p-4 md:p-10"
         @keydown.window.escape="open = false"
         @keydown.window.left="prev()"
         @keydown.window.right="next()">
        
        <button @click.stop="open = false" class="absolute top-6 right-6 text-white/50 hover:text-white transition-colors z-[110]">
            <i class="fas fa-times text-3xl"></i>
        </button>

        <button @click.stop="prev()" class="absolute left-6 text-white/30 hover:text-white transition-colors p-4 hidden md:block z-[110]">
            <i class="fas fa-chevron-left text-4xl"></i>
        </button>
        <button @click.stop="next()" class="absolute right-6 text-white/30 hover:text-white transition-colors p-4 hidden md:block z-[110]">
            <i class="fas fa-chevron-right text-4xl"></i>
        </button>

        <div class="relative max-w-5xl max-h-full flex items-center justify-center" 
             @click.outside="open = false"> <img :src="images[currentIndex]" 
                 class="max-w-full max-h-[85vh] object-contain rounded-lg shadow-2xl select-none"
                 @click.stop> <div class="absolute -bottom-10 left-0 right-0 text-center">
                <span class="text-white/40 text-[10px] font-bold uppercase tracking-[0.4em]" 
                      x-text="(currentIndex + 1) + ' / ' + images.length"></span>
            </div>
        </div>
    </div>
</template>
</section>
{% endblock %}